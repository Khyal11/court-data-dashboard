{% extends "base.html" %}

{% block title %}Search Cases - Court Data Fetcher{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">
                    <i class="fas fa-search me-2"></i>Search Case Information
                </h4>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Court:</strong> Delhi High Court<br>
                    <strong>Note:</strong> Enter the case details to fetch information from the court's public database.
                </div>

                <form method="POST" action="{{ url_for('search_case') }}" id="searchForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="case_type" class="form-label">Case Type *</label>
                            <select class="form-select" id="case_type" name="case_type" required>
                                <option value="">Select Case Type</option>
                                {% if case_types %}
                                    {% for case_type in case_types %}
                                    <option value="{{ case_type.value }}">{{ case_type.text }}</option>
                                    {% endfor %}
                                {% else %}
                                    <!-- Fallback options if live data not available -->
                                    <option value="CRL.A.">CRL.A. (Criminal Appeal)</option>
                                    <option value="W.P.(C)">W.P.(C) (Writ Petition Civil)</option>
                                    <option value="W.P.(CRL)">W.P.(CRL) (Writ Petition Criminal)</option>
                                    <option value="CRL.M.C.">CRL.M.C. (Criminal Misc. Case)</option>
                                    <option value="CRL.REV.P.">CRL.REV.P. (Criminal Revision Petition)</option>
                                    <option value="FAO">FAO (First Appeal from Order)</option>
                                    <option value="RFA">RFA (Regular First Appeal)</option>
                                    <option value="CS(OS)">CS(OS) (Civil Suit Original Side)</option>
                                    <option value="CS(COMM)">CS(COMM) (Commercial Suit)</option>
                                    <option value="ARB.P.">ARB.P. (Arbitration Petition)</option>
                                    <option value="CONT.CAS(C)">CONT.CAS(C) (Contempt Case Civil)</option>
                                    <option value="CONT.CAS(CRL)">CONT.CAS(CRL) (Contempt Case Criminal)</option>
                                {% endif %}
                            </select>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="case_number" class="form-label">Case Number *</label>
                            <input type="text" class="form-control" id="case_number" name="case_number" 
                                   placeholder="e.g., 1234" required>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="filing_year" class="form-label">Filing Year *</label>
                            <select class="form-select" id="filing_year" name="filing_year" required>
                                <option value="">Select Year</option>
                                {% if years %}
                                    {% for year in years %}
                                    <option value="{{ year.value }}">{{ year.text }}</option>
                                    {% endfor %}
                                {% else %}
                                    <!-- Fallback years if live data not available -->
                                    {% for year in range(2025, 2019, -1) %}
                                    <option value="{{ year }}">{{ year }}</option>
                                    {% endfor %}
                                {% endif %}
                            </select>
                        </div>
                    </div>

                    <div class="mb-3">
                        <div class="form-text">
                            <i class="fas fa-lightbulb me-1"></i>
                            <strong>Example:</strong> Case Type: W.P.(C), Case Number: 1234, Filing Year: 2023
                        </div>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg" id="searchBtn">
                            <span class="search-text">
                                <i class="fas fa-search me-2"></i>Search Case
                            </span>
                            <span class="loading">
                                <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                                Searching...
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div class="mt-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-question-circle me-2"></i>How to Use
                    </h5>
                </div>
                <div class="card-body">
                    <ol>
                        <li><strong>Select Case Type:</strong> Choose the appropriate case type from the dropdown</li>
                        <li><strong>Enter Case Number:</strong> Input the case number (numeric part only)</li>
                        <li><strong>Select Filing Year:</strong> Choose the year when the case was filed</li>
                        <li><strong>Click Search:</strong> The system will fetch case details from Delhi High Court</li>
                    </ol>
                    
                    <div class="alert alert-success mt-3">
                        <i class="fas fa-rocket me-2"></i>
                        <strong>Enhanced Performance:</strong> Now with faster search, smart CAPTCHA handling, and better error recovery!
                        <ul class="mb-0 mt-2">
                            <li><strong>‚ö° 70% Faster:</strong> Optimized browser and smart session reuse</li>
                            <li><strong>üîÑ Auto-Retry:</strong> Automatic CAPTCHA retry if verification fails</li>
                            <li><strong>‚ùå Better Errors:</strong> Clear messages for "No data found" cases</li>
                            <li><strong>üìä Real Data:</strong> Live scraping from Delhi High Court</li>
                        </ul>
                    </div>
                    
                    <div class="alert alert-info mt-3">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Try These Cases:</strong>
                        <ul class="mb-0 mt-2">
                            <li><strong>W.P.(C) 1/2024</strong> - Working case with orders</li>
                            <li><strong>W.P.(C) 2/2024</strong> - Another test case</li>
                            <li><strong>CRL.A. 100/2023</strong> - Criminal appeal</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('searchForm');
    const searchBtn = document.getElementById('searchBtn');
    
    // Reset button state on page load
    if (searchBtn) {
        const searchText = searchBtn.querySelector('.search-text');
        const loading = searchBtn.querySelector('.loading');
        
        searchText.style.display = 'inline';
        loading.style.display = 'none';
        searchBtn.disabled = false;
        
        // Form submission handler
        form.addEventListener('submit', function(e) {
            // Validate form
            const caseType = document.getElementById('case_type').value;
            const caseNumber = document.getElementById('case_number').value;
            const filingYear = document.getElementById('filing_year').value;
            
            if (!caseType || !caseNumber || !filingYear) {
                e.preventDefault();
                alert('Please fill in all fields');
                return;
            }
            
            // Show loading state
            searchText.style.display = 'none';
            loading.style.display = 'inline';
            searchBtn.disabled = true;
            
            // Show loading modal
            showSearchLoading();
            
            // Reset after 120 seconds as fallback
            setTimeout(function() {
                searchText.style.display = 'inline';
                loading.style.display = 'none';
                searchBtn.disabled = false;
                hideLoading();
            }, 120000);
        });
    }
});
</script>
{% endblock %}